{% extends 'ecommerce/extends/header2.html' %}
{% load humanize %}

{% load static %}
{% block extrahead %}
   <link rel="stylesheet" type="text/css" href="{% static 'css/checkout.css' %}">
{% endblock%}
{% block extrascript%}
    <script>
    function prev(){
        window.history.go(-1);
        return false;
    }
    $(document).ready( function(){
        var price = document.getElementById('price').value;
        var install = price/24.0;
        $("#subtotal").html(parseFloat(price).toLocaleString());
        $("#install").html(install.toFixed(2).toLocaleString());
        $("#grandtotal").html(parseFloat(price).toLocaleString());


    });

    $(document).on('click','#spinner div',function(){
        var qty = document.getElementsByClassName('qty');
        var i = 0;
        var price = document.getElementById('price').value;
        var quantity = parseInt(qty[i].getAttribute('value'));
        var subtotal,install = 0;


        if(this.getAttribute('data-action') === 'up') {
            if(quantity < parseInt(qty[i].getAttribute('max')))
            qty[i].setAttribute('value',parseInt(qty[i].getAttribute('value'), 10) + 1);

        }
        else{
            if ( quantity > parseInt(qty[i].getAttribute('min'))) {
                qty[i].setAttribute('value',parseInt(qty[i].getAttribute('value'), 10) - 1);
            }
        }
        subtotal = parseFloat(parseInt(qty[i].getAttribute('value'))*price);
        install = subtotal/24.0;

        $("#subtotal").html(subtotal.toLocaleString());
        $("#install").html(install.toFixed(2).toLocaleString());
        $("#grandtotal").html(subtotal.toLocaleString());

    });

    </script>
{% endblock%}
{% block body %}
{% if user.is_authenticated %}
<!--%if cart != empty%}-->

<div class="d-flex flex-column">
    <div id="continue" class="mt-3">
        <a href="/" role="button" class="pull-left text-success" style="text-decoration: none;">
            <small><i id="continuebtn" class="fa fa-angle-left ml-5" ></i>&nbsp;&nbsp;<strong>Continue Shopping</strong></small>
        </a>

    </div>
    <form action="#" method="POST" id="myForm">
    {% csrf_token %}
    <div class="d-flex container-fluid" >
        <form method="POST"></form>
        <div class="col-md-9 col">

            <div class="ml-4 mt-3 my-2 container" >
                <div class="card-header">
                    <div class="ml-auto row">
                        <div class="col-5"><strong>ITEM NAME</strong></div>
                        <div class="col-5"><strong>ITEM PRICE</strong></div>
                        <div class="col"><strong>QUANTITY</strong></div>
                    </div>
                </div>
                <div class="ml-auto mt-3 container row"  >
                    <div class="col-lg-5 d-flex" >
                        <img src="{{ product.image.url }}"  style="width: 150px; height:150px;"/>
                        <div class="mt-3" style="overflow: hidden; text-overflow: ellipsis;">
                            <div><strong>{{product.prodname}}</strong></div>
                            <div style="overflow: hidden; text-overflow: ellipsis;" >{{product.description}}</div>
                        </div>
                    </div>
                    <div class="col mt-3"><strong>&#x20B1 {{product.price|intcomma}}</strong></div>
                    <div class="col-3 mt-3">

                            <div  id="spinner" class="input-group number-spinner">
                                <span class="input-group-btn data-dwn">
                                    <div id="id_down" class="btn btn-outline-success btn-info"  data-action="dwn"><i id="minus" class="fa fa-minus"></i></div>
                                </span>
                                <input type="number"id="price" value="{{product.price}}" hidden/>

                                <input type="number" name="productid" value="{{product.id}}" hidden/>
                                <input type="number" name="quantity" class="qty form-control text-center" value="1" min="1" max="{{product.quantity}}">

                                <span class="input-group-btn data-up">
                                    <div id="id_up" class="btn btn-outline-success btn-info" data-action="up"><i class="fa fa-plus"></i></div>
                                </span>
                            </div>


                    </div>
                </div>
                <hr/>

            </div>
        </div>
        <div class="col-lg-3 col-sm-3">
            <div class="card">
                <div class="card-block">
                    <div class="card-header">Order Summary</div>
                    <div class="card-body">
                        <div class="card-text">Subtotal&nbsp;&nbsp;<strong>&#x20B1<span id="subtotal"> 0.00</span></strong></div>
                        <hr/>
                        <div class="card-text">Installments &nbsp;&nbsp;<strong>&#x20B1 <span id="install"> 0.00</span> x 24</strong></div>
                    </div>

                    <div class="card-footer">Grand Total &nbsp;&nbsp;<strong>&#x20B1<span id="grandtotal"> 0.00</span></strong></div>
                </div>
            </div>
            <div class="text-center" ><a href="#" onclick="submit();" id="nextstep" role="button" class="mt-3 btn-block btn btn-outline-success btn-lg" >Next Step</a></div>
        </div>

    </div>
    </form>
</div>

<!--%else%}-->
<!--<div class="container">-->
    <!--<div class="text-center m-5">-->
        <!--<h3>There are no items in this cart.</h3>-->
        <!--<a href="#" onclick="prev();" role="button" style="background-color: #17a2b8;" class="mt-3  btn btn-primary btn-lg">CONTINUE SHOPPING</a>-->
    <!--</div>-->
<!--</div>-->
<!--%endif%}-->
{% else %}
<div class="container">
    <div class="text-center m-5">
        <h1>

            <i class="fa fa-exclamation-triangle" style="color: red; font-size: 60px;"></i>
            <strong >&nbsp; PLEASE LOGIN TO CONTINUE</strong>
        </h1>

        <a href="#" onclick="prev();" role="button" class="mt-3 btn btn-outline-success btn-lg">CONTINUE SHOPPING</a>
    </div>
</div>

{% endif %}
<script>
    function submit(){
        document.getElementById('myForm').submit();
    }
</script>
{% endblock %}
